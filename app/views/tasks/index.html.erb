<% content_for :title, "Tarefas - #{@task_list.name}" %>

<div class="container py-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item"><%= link_to "Listas", task_lists_path %></li>
      <li class="breadcrumb-item"><%= link_to @task_list.name, task_list_path(@task_list) %></li>
      <li class="breadcrumb-item active" aria-current="page">Tarefas</li>
    </ol>
  </nav>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Tarefas de <span class="fw-semibold"><%= @task_list.name %></span></h1>
    <%= link_to "➕ Nova Tarefa", new_task_list_task_path(@task_list), class: "btn btn-primary" %>
  </div>

  <% grouped = @tasks.group_by(&:status) %>
  <div class="row g-3">
    <% [["todo","A Fazer","secondary"], ["doing","Em Progresso","warning"], ["done","Concluídas","success"]].each do |key, title, color| %>
      <div class="col-12 col-md-4">
        <div class="card h-100 shadow-sm">
          <div class="card-header bg-<%= color %> bg-opacity-10">
            <div class="d-flex justify-content-between align-items-center">
              <span class="fw-semibold"><%= title %></span>
              <span class="badge text-bg-<%= color %>"><%= grouped[key]&.size || 0 %></span>
            </div>
          </div>
          <div class="card-body">
            <% if grouped[key].present? %>
              <div class="list-group">
                <% grouped[key].each do |task| %>
                  <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <div>
                      <div class="fw-semibold <%= 'text-decoration-line-through text-muted' if task.done? %>">
                        <%= link_to task.title,
                                    [@task_list, task],
                                    class: "text-decoration-none #{'text-muted' if task.done?}",
                                    title: task.title %>
                      </div>
                      <div class="small text-muted">
                        Prioridade:
                        <span class="badge rounded-pill text-bg-light">
                          <%= task.priority.presence || '-' %>
                        </span>
                        <span class="ms-2 badge <%= task.done? ? 'text-bg-success' : 'text-bg-warning text-dark' %>">
                          <%= task.done? ? 'Concluída' : 'Pendente' %>
                        </span>
                      </div>
                    </div>
                    <div class="btn-group btn-group-sm">
                      <%= link_to "Editar",
                                  edit_task_list_task_path(@task_list, task),
                                  class: "btn btn-outline-primary",
                                  title: "Editar Tarefa" %>
                      <%= button_to "Excluir",
                                    task_list_task_path(@task_list, task),
                                    method: :delete,
                                    form: { data: { confirm_modal: confirm_message(task) }, class: "d-inline" },
                                    class: "btn btn-outline-danger",
                                    title: "Excluir Tarefa" %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="text-muted small">Sem tarefas</div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
