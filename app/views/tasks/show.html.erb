<% can_edit   = @task_list.can_edit_tasks?(current_user) %>
<% can_delete = @task_list.can_delete_tasks?(current_user) %>
<% content_for :title, "#{@task.title} - #{@task_list.name}" %>

<div class="container py-4" style="max-width: 900px;">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0 small">
      <li class="breadcrumb-item"><%= link_to "Listas", task_lists_path %></li>
      <li class="breadcrumb-item"><%= link_to @task_list.name, task_list_path(@task_list) %></li>
      <li class="breadcrumb-item active" aria-current="page"><%= @task.title %></li>
    </ol>
  </nav>

  <!-- Header -->
  <div class="card shadow-sm mb-4 border-0" style="border-left:.4rem solid <%= @task_list.color %>;">
    <div class="card-body">
      <% icon = @task.done? ? "‚úÖ" : (@task.doing? ? "üîÑ" : "‚è≥") %>
      <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
        <div>
          <h1 class="h4 mb-2 d-flex align-items-center gap-2 <%= 'text-muted text-decoration-line-through' if @task.done? %>">
            <span><%= icon %></span>
            <span class="lh-sm"><%= @task.title %></span>
          </h1>

          <div class="d-flex flex-wrap gap-2">
            <span class="badge rounded-pill text-bg-secondary">üìã <%= @task_list.name %></span>
            <% status_variant =
                if @task.done? then 'success'
                elsif @task.doing? then 'warning text-dark'
                else 'secondary'
                end %>
            <span class="badge rounded-pill text-bg-<%= status_variant %>">
              <%= I18n.t("activerecord.enums.task.status.#{@task.status}", default: @task.status.humanize) %>
            </span>
            <span class="badge rounded-pill text-bg-dark">
              Prioridade: <%= @task.priority.presence || '-' %>
            </span>
            <% if @task.respond_to?(:due_date) && @task.due_date.present? %>
              <span class="badge rounded-pill <%= (@task.respond_to?(:overdue?) && @task.overdue?) ? 'text-bg-danger' : 'text-bg-light text-dark' %>">
                üìÖ <%= l(@task.due_date, format: :short) rescue @task.due_date.strftime('%d/%m/%Y') %>
              </span>
            <% end %>
          </div>
        </div>

        <!-- A√ß√µes (padr√µes alinhados com outras telas) -->
        <div class="d-flex flex-wrap gap-2">
          <%= link_to "‚Ü©Ô∏è Voltar", task_list_path(@task_list), class: "btn btn-outline-secondary d-inline-flex align-items-center" %>
          <% if can_edit %>
            <%= link_to "‚úèÔ∏è Editar", edit_task_list_task_path(@task_list, @task), class: "btn btn-warning text-dark d-inline-flex align-items-center" %>
          <% end %>
          <% if can_delete %>
            <%= button_to "üóë Excluir",
                  task_list_task_path(@task_list, @task),
                  method: :delete,
                  form: { data: { confirm_modal: confirm_message(@task) }, class: "d-inline" },
                  class: "btn btn-danger d-inline-flex align-items-center" %>
          <% end %>
        </div>
      </div>

      <!-- Descri√ß√£o -->
      <% if @task.description.present? %>
        <hr class="my-3">
        <h2 class="h6 text-uppercase text-muted mb-2">Descri√ß√£o</h2>
        <div class="bg-light rounded p-3 small">
          <%= simple_format(@task.description) %>
        </div>
      <% end %>

      <!-- Detalhes -->
      <hr class="my-4">
      <div class="row g-3 small">
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="text-muted text-uppercase fw-semibold small mb-1">Criada em</div>
          <div><%= l(@task.created_at, format: :short) %></div>
        </div>
        <div class="col-12 col-sm-6 col-lg-4">
          <div class="text-muted text-uppercase fw-semibold small mb-1">Atualizada em</div>
          <div><%= l(@task.updated_at, format: :short) %></div>
        </div>
        <% if @task.respond_to?(:user) && @task.user.present? %>
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="text-muted text-uppercase fw-semibold small mb-1">Criada por</div>
            <div><%= @task.user.try(:full_name) || @task.user.try(:name) || @task.user.email %></div>
          </div>
        <% end %>
        <% if @task.respond_to?(:due_date) && @task.due_date.present? %>
          <div class="col-12 col-sm-6 col-lg-4">
            <div class="text-muted text-uppercase fw-semibold small mb-1">Vencimento</div>
            <div class="<%= (@task.respond_to?(:overdue?) && @task.overdue?) ? 'text-danger fw-semibold' : '' %>">
              <%= @task.due_date.strftime('%d/%m/%Y %H:%M') %>
              <% if @task.respond_to?(:overdue?) && @task.overdue? %>
                <div class="small">‚ö†Ô∏è Atrasada</div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

    </div>
  </div>
</div>
