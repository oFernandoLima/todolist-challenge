<% content_for :title, "#{@task.title} - #{@task_list.name}" %>

<div class="container py-4" style="max-width: 900px;">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb mb-0">
      <li class="breadcrumb-item"><%= link_to "Listas", task_lists_path %></li>
      <li class="breadcrumb-item">
        <%= link_to @task_list.name, task_list_path(@task_list), style: "color: #{@task_list.color}" %>
      </li>
      <li class="breadcrumb-item active" aria-current="page"><%= @task.title %></li>
    </ol>
  </nav>

  <!-- Header -->
  <div class="card shadow-sm mb-3" style="border-left: 0.25rem solid <%= @task_list.color %>;">
    <div class="card-body">
      <% icon = @task.done? ? "✅" : (@task.doing? ? "🔄" : "⏳") %>
      <div class="d-flex justify-content-between align-items-start">
        <h1 class="h4 mb-2 <%= 'text-muted text-decoration-line-through' if @task.done? %>">
          <%= icon %> <%= @task.title %>
        </h1>
        <div class="d-flex gap-2 flex-wrap">
          <span class="badge rounded-pill text-bg-secondary">📋 <%= @task_list.name %></span>
          <span class="badge
            <%= @task.done? ? 'text-bg-success' :
                 @task.doing? ? 'text-bg-warning text-dark' :
                 'text-bg-light text-dark' %>">
            <%= I18n.t("activerecord.enums.task.status.#{@task.status}", default: @task.status.humanize) %>
          </span>
          <span class="badge text-bg-dark">
            Prioridade: <%= @task.priority.presence || '-' %>
          </span>
        </div>
      </div>

      <dl class="row mb-0 mt-3 small">
        <dt class="col-sm-3">Criada em</dt>
        <dd class="col-sm-9"><%= l(@task.created_at, format: :short) %></dd>

        <dt class="col-sm-3">Atualizada em</dt>
        <dd class="col-sm-9"><%= l(@task.updated_at, format: :short) %></dd>

        <% if @task.respond_to?(:description) && @task.description.present? %>
          <dt class="col-sm-3">Descrição</dt>
          <dd class="col-sm-9"><%= simple_format(@task.description) %></dd>
        <% end %>
      </dl>
    </div>
  </div>

  <!-- Ações -->
  <div class="card shadow-sm">
    <div class="card-body d-flex flex-wrap gap-2 justify-content-center">
      <%= link_to "↩️ Voltar para Lista", task_list_path(@task_list), class: "btn btn-secondary" %>
      <%= link_to "✏️ Editar Tarefa", edit_task_list_task_path(@task_list, @task), class: "btn btn-primary" %>

      <!-- Toggle status (done <-> todo) -->
      <%= form_with model: [@task_list, @task], method: :patch, local: true, class: "d-inline" do |form| %>
        <%= form.hidden_field :status, value: (@task.done? ? 'todo' : 'done') %>
        <%= form.submit (@task.done? ? "⏳ Marcar como A Fazer" : "✅ Marcar como Concluída"),
              class: (@task.done? ? "btn btn-warning text-dark" : "btn btn-success") %>
      <% end %>

      <%= button_to "🗑️ Excluir Tarefa",
            task_list_task_path(@task_list, @task),
            method: :delete,
            form: { data: { confirm_modal: confirm_message(@task) }, class: "d-inline" },
            class: "btn btn-danger" %>
    </div>
  </div>
</div>
